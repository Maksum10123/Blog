{% extends 'base/base.html' %}

{% block content %}
<link href="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.css" rel="stylesheet" type="text/css" />

<style>
    /* Вставляем сюда CSS из прошлого ответа для контейнера и кнопок */
    .container { max-width: 600px; margin: 40px auto; background: #fff; padding: 30px; border-radius: 10px; box-shadow: 0 4px 15px rgba(0,0,0,0.1); }
    .form-group { margin-bottom: 20px; }
    .form-group label { display: block; margin-bottom: 8px; font-weight: 500; color: #555; }

    /* Стили для инпутов, чтобы они сочетались с Tagify */
    input[type="text"], textarea, select {
        width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; box-sizing: border-box;
    }

    /* Кнопки */
    .form-actions { display: flex; gap: 15px; margin-top: 20px; }
    button[type="submit"] { background: #27ae60; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; }
    .btn-cancel { color: #7f8c8d; text-decoration: none; align-self: center;}

    /* -- Настройки специально для Tagify -- */
    .tagify {
        width: 100%;
        border-radius: 6px;
        border: 1px solid #ddd;
        --tags-border-color: #ddd;
        --tags-focus-border-color: #3498db;
    }
</style>

<div class="container">
    <h2>Редактирование поста</h2>

    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}

        {% for field in form %}
            <div class="form-group">
                <label for="{{ field.id_for_label }}">{{ field.label }}</label>

                {{ field }}

                {% if field.errors %}
                    <div class="error" style="color: red; font-size: 0.9em;">{{ field.errors }}</div>
                {% endif %}
            </div>
        {% endfor %}

        {% if post.image %}
            <div style="margin: 20px 0; text-align: center;">
                <p style="color: #666;">Текущее изображение:</p>
                <img src="{{ post.image.url }}" style="max-width: 200px; border-radius: 8px;">
            </div>
        {% endif %}

        <div class="form-actions">
            <button type="submit">Сохранить изменения</button>
            <a href="{% url 'post_detail' post.id %}" class="btn-cancel">Отмена</a>
        </div>
    </form>
</div>

<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify"></script>
<script src="https://cdn.jsdelivr.net/npm/@yaireo/tagify/dist/tagify.polyfills.min.js"></script>

<script>
    document.addEventListener("DOMContentLoaded", function() {
        // Находим input с именем 'tags' (оно должно совпадать с именем поля в forms.py)
        var input = document.querySelector('input[name=tags]');

        if (input) {
            // Инициализируем Tagify
            new Tagify(input, {
                // Здесь можно добавить настройки
                delimiters: ", ", // Разделители для ввода
                maxTags: 10,
                blacklist: ["мат", "запрещенное_слово"],
                originalInputValueFormat: valuesArr => valuesArr.map(item => item.value).join(',') // Важно! Отправлять на сервер строку через запятую
            });
        }
    });
</script>
{% endblock %}