{% extends "base/base.html" %}
{% load static %}

{% block content %}

<div class="row justify-content-center">
    <div class="col-lg-8 col-md-10">

        <div class="search-hero-card">
            <h1 class="search-title"><i class="fa-solid fa-hashtag"></i>Поиск по тегам</h1>

            <form action="{% url 'search' %}" method="get">
                <div class="search-input-group">
                    <input
                        type="text"
                        name="q"
                        class="custom-input"
                        value="{{ query|default:'' }}"
                        placeholder="Например: nature, python, music..."
                    >
                    <button type="submit" class="custom-btn">Найти</button>
                </div>
            </form>

            <div class="all-available-tags">
                <p class="tags-label">Популярные запросы</p>
                <div class="popular-tags">
                    {% for tag in all_tags %}
                        <a href="?q={{ tag.name }}">#{{ tag.name }}</a>
                    {% endfor %}
                </div>
            </div>
        </div>

        <hr style="border-top: 2px dashed #e1e1e1; margin-bottom: 40px; opacity: 0.5;">

        <div class="search-results">
            {% if query %}
                <h4 class="mb-4 text-center text-secondary">Результаты по запросу: <span class="text-dark fw-bold">#{{ query }}</span></h4>

                {% if result %}
                    <div class="posts-list">
                        {% for post in result %}

                        <div class="card social-card">
                            <div class="card-header-custom">
                                {% if post.author.avatar %}
                                    <img src="{{ post.author.avatar.url }}" class="author-avatar" alt="ava">
                                {% else %}
                                    <img src="https://static.vecteezy.com/system/resources/previews/009/292/244/non_2x/default-avatar-icon-of-social-media-user-vector.jpg" class="author-avatar" alt="def">
                                {% endif %}

                                <div>
                                    <strong class="d-block text-dark">{{ post.author }}</strong>
                                    <small class="text-muted">{{ post.created_at|date:"d M Y" }}</small>
                                </div>
                            </div>

                            {% if post.image %}
                                <img src="{{ post.image.url }}" class="post-img" alt="Post Image">
                            {% endif %}

                            <div class="card-body-custom">
                                <p class="card-text text-secondary">{{ post.description|truncatewords:30 }}</p>

                                {% if post.tags.all %}
                                <div class="mt-3">
                                    {% for tag in post.tags.all %}
                                    <a href="?q={{ tag.name }}" class="post-tag-pill">#{{ tag.name }}</a>
                                    {% endfor %}
                                </div>
                                {% endif %}

                                <div class="mt-3 pt-3 border-top d-flex justify-content-between text-muted">
                                    <span><i class="fa-regular fa-heart me-1"></i> Лайк</span>
                                    <a href="{% url 'post_detail' post.id %}" class="text-decoration-none text-muted">Подробнее <i class="fa-solid fa-arrow-right ms-1"></i></a>
                                </div>
                            </div>
                        </div>

                        {% endfor %}
                    </div>
                {% else %}
                    <div class="empty-search">
                        <i class="fa-solid fa-magnifying-glass fa-3x mb-3"></i>
                        <h3>Упс, ничего нет</h3>
                        <p>По тегу "<strong>{{ query }}</strong>" постов не найдено.</p>
                        <a href="{% url 'search' %}" class="btn btn-outline-secondary mt-2">Сбросить фильтр</a>
                    </div>
                {% endif %}

            {% endif %}
        </div>

    </div>
</div>

{% endblock %}